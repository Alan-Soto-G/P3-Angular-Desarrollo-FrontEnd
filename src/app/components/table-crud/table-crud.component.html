<!-- Header con t√≠tulo y bot√≥n a√±adir -->
<div class="header bg-gradient-danger pb-8 pt-5 pt-md-8"></div>

<div class="container-fluid mt--7">
  <div class="row">
    <div class="col">
      <div class="card shadow">
        <!-- Card header con t√≠tulo y bot√≥n -->
        <div class="card-header bg-transparent">
          <div class="row align-items-center">
            <div class="col">
              <h3 class="mb-0">{{ title }}</h3>
            </div>
            <div class="col text-right" *ngIf="showAddButton">
              <button class="btn btn-success" (click)="handleAddClick()">
                <i class="fas fa-plus"></i> {{ addButtonText }}
              </button>
            </div>
          </div>
        </div>

        <!-- Card body con la tabla -->
        <div class="card-body">
          <!-- Loading state -->
          <div *ngIf="isLoading" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Cargando...</span>
            </div>
            <p class="mt-2 text-muted">Cargando datos...</p>
          </div>

          <!-- Table content -->
          <div class="table-responsive" *ngIf="!isLoading">
            <table class="table align-items-center table-flush">
              <!-- Encabezados de la tabla -->
              <thead class="thead-light">
                <tr>
                  <th scope="col" *ngFor="let header of headers">
                    {{ header }}
                  </th>
                  <!-- Si se definen botones adicionales se muestra la columna de Acciones -->
                  <th scope="col" *ngIf="buttons && buttons.length > 0" class="text-center">
                    Acciones
                  </th>
                </tr>
              </thead>

              <!-- Cuerpo de la tabla -->
              <tbody>
                <!-- Fila por cada elemento en data -->
                <tr *ngFor="let row of data; let i = index" (click)="handleRowClick(row, i)" style="cursor: pointer;">
                  
                  <!-- Para usuarios: mostrar datos + emojis + bot√≥n crear sesi√≥n -->
                  <ng-container *ngIf="title === 'Gesti√≥n de Usuarios'">
                    <td class="text-sm">{{ row.id }}</td>
                    <td class="text-sm">{{ row.name }}</td>
                    <td class="text-sm">{{ row.email }}</td>
                    <!-- Botones con emojis en columnas de √≠conos -->
                    <td class="text-center">
                      <button class="btn btn-sm btn-outline-primary" 
                              (click)="$event.stopPropagation()" 
                              title="Direccion">
                        üè†
                      </button>
                    </td>
                    <td class="text-center">
                      <button class="btn btn-sm btn-outline-success" 
                              (click)="$event.stopPropagation()" 
                              title="Firma Digital">
                        ‚úçÔ∏è
                      </button>
                    </td>
                    <td class="text-center">
                      <button class="btn btn-sm btn-outline-info" 
                              (click)="$event.stopPropagation()" 
                              title="Dispositivos">
                        üì±
                      </button>
                    </td>
                    <td class="text-center">
                      <button class="btn btn-sm btn-outline-warning" 
                              (click)="$event.stopPropagation()" 
                              title="Contrase√±as">
                        üîê
                      </button>
                    </td>
                    <!-- Columna "Sesiones": bot√≥n para crear la sesi√≥n -->
                    <td class="text-center">
                      <button class="btn btn-sm btn-outline-secondary" 
                              (click)="handleCreateSessionClick(row, i); $event.stopPropagation()" 
                              title="Crear sesi√≥n">
                        ‚è∞
                      </button>
                    </td>
                    <td class="text-sm">{{ row.acciones }}</td>
                  </ng-container>

                  <!-- Para sesiones: mostrar todos los datos directamente -->
                  <ng-container *ngIf="title === 'Gesti√≥n de Sesiones'">
                    <td class="text-sm">{{ row.id }}</td>
                    <td class="text-sm">{{ row.token }}</td>
                    <td class="text-sm">{{ row.expiration }}</td>
                    <td class="text-sm">{{ row.FACode }}</td>
                    <td class="text-sm">
                      <span class="badge" 
                            [ngClass]="{
                              'badge-success': row.state === 'active',
                              'badge-warning': row.state === 'expired',
                              'badge-danger': row.state === 'revoked'
                            }">
                        {{ row.state }}
                      </span>
                    </td>
                    <td class="text-sm">{{ row.acciones }}</td>
                  </ng-container>

                  <!-- Para perfiles: mostrar datos espec√≠ficos -->
                  <ng-container *ngIf="title === 'Gesti√≥n de Perfiles'">
                    <td class="text-sm">{{ row.id }}</td>
                    <td class="text-sm">{{ row.usuario }}</td>
                    <td class="text-sm">{{ row.telefono }}</td>
                    <td class="text-center">{{ row.foto }}</td>
                    <td class="text-sm">{{ row.acciones }}</td>
                  </ng-container>

                  <!-- Para otras tablas: mostrar datos gen√©ricos -->
                  <ng-container *ngIf="title !== 'Gesti√≥n de Usuarios' && title !== 'Gesti√≥n de Sesiones' && title !== 'Gesti√≥n de Perfiles'">
                    <td class="text-sm" *ngFor="let header of headers; let j = index">
                      {{ row[getPropertyName(header)] }}
                    </td>
                  </ng-container>

                  <!-- Celda de acciones con botones adicionales (si existen) -->
                  <td *ngIf="buttons && buttons.length > 0" class="text-center">
                    <button *ngFor="let button of buttons" 
                            [class]="'btn ' + button.class + ' mr-1'"
                            (click)="handleButtonClick(button.label, row, i); $event.stopPropagation()"
                            [title]="button.label">
                      <i [class]="'fas ' + button.icon" *ngIf="button.icon"></i>
                      <span *ngIf="!button.icon">{{ button.label }}</span>
                    </button>
                  </td>
                </tr>

                <!-- Mensaje cuando no hay datos -->
                <tr *ngIf="data.length === 0">
                  <td [attr.colspan]="buttons && buttons.length > 0 ? headers.length + 1 : headers.length" class="text-center py-4">
                    <div class="text-muted">
                      <i class="fas fa-inbox fa-2x mb-3"></i>
                      <p>No hay datos disponibles</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>